<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <!-- Meta Tags Essenciais -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- SEO e Descri√ß√£o -->
    <title>Secretaria - Balc√£o da Cidadania | Arimateia</title>
    <meta name="description" content="Interface da Secretaria para gest√£o avan√ßada de chamados e administra√ß√£o do sistema.">
    <meta name="keywords" content="secretaria, gest√£o chamados, administra√ß√£o, arimateia">
    <meta name="author" content="Arimateia">
    <meta name="robots" content="noindex, nofollow">
    
    <!-- Favicon e Icons -->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.png">
    
    <!-- Preload Critical Resources -->
    <link rel="preload" href="assets/style.css" as="style">
    <link rel="preload" href="data/config.js" as="script">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="assets/style.css">
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' 'unsafe-eval' https://script.google.com https://script.googleusercontent.com https://apis.google.com;
        style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com;
        font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com;
        img-src 'self' data: https:;
        connect-src 'self' https: https://script.google.com https://script.googleusercontent.com https://docs.google.com https://sheets.googleapis.com;
        frame-src 'none';
        object-src 'none';
        base-uri 'self';
        form-action 'self' https://script.google.com;
    ">
</head>
<body>
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="sr-only">Pular para o conte√∫do principal</a>

    <!-- Header -->
    <header class="header" role="banner">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <img src="assets/logo.png" alt="Logo Arimateia" width="32" height="32" onerror="this.style.display='none'">
                    <span>Balc√£o da Cidadania</span>
                </div>
                
                <div class="user-info">
                    <img src="assets/default-avatar.png" alt="Avatar do usu√°rio" class="user-avatar" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiMwMGM2ZmYiLz4KPC9zdmc+'">
                    <div class="user-details">
                        <div class="user-name" aria-live="polite">Carregando...</div>
                        <div class="user-role text-secondary" aria-live="polite">-</div>
                    </div>
                    <nav class="user-actions" role="navigation" aria-label="A√ß√µes do usu√°rio">
                        <button id="notifications-btn" class="btn btn-outline" aria-label="Notifica√ß√µes" title="Notifica√ß√µes">
                            <span class="icon">üîî</span>
                            <span class="notification-badge hidden">0</span>
                        </button>
                        <button id="back-to-dashboard" class="btn btn-outline" aria-label="Voltar ao dashboard" title="Dashboard">
                            <span class="icon">‚¨ÖÔ∏è</span>
                            <span class="btn-text">Dashboard</span>
                        </button>
                        <button id="logout-btn" class="btn btn-secondary" aria-label="Sair do sistema" title="Logout">
                            <span class="icon">üö™</span>
                            <span class="btn-text">Sair</span>
                        </button>
                    </nav>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="main-content" role="main">
        <div class="container">
            <!-- Page Header -->
            <div class="page-header mb-4">
                <h1>üìã Secretaria</h1>
                <p class="text-secondary">Gest√£o avan√ßada de chamados e administra√ß√£o do sistema</p>
            </div>

            <!-- Action Buttons -->
            <div class="actions-section mb-4">
                <button id="new-ticket-btn" class="btn btn-primary btn-large" aria-label="Criar novo chamado">
                    <span class="icon">‚ûï</span>
                    <span class="btn-text">Novo Chamado</span>
                </button>
                <button id="profissionais-btn" class="btn btn-primary" aria-label="Gerenciar profissionais">
                    <span class="icon">üë®‚Äç‚öïÔ∏è</span>
                    <span class="btn-text">Profissionais</span>
                </button>
                <button id="assessores-btn" class="btn btn-primary" aria-label="Gerenciar assessores">
                    <span class="icon">üèõÔ∏è</span>
                    <span class="btn-text">Assessores</span>
                </button>
                <button id="relatorios-btn" class="btn btn-info" aria-label="Gerar relat√≥rios">
                    <span class="icon">üìÑ</span>
                    <span class="btn-text">Relat√≥rios</span>
                </button>
                <button id="export-tickets-btn" class="btn btn-success" aria-label="Exportar dados">
                    <span class="icon">üìä</span>
                    <span class="btn-text">Exportar Dados</span>
                </button>
                <button id="refresh-tickets-btn" class="btn btn-outline" aria-label="Atualizar lista">
                    <span class="icon">üîÑ</span>
                    <span class="btn-text">Atualizar Lista</span>
                </button>
            </div>

            <!-- Enhanced Filters -->
            <div class="filters" role="search" aria-label="Filtros avan√ßados de chamados">
                <div class="filter-group">
                    <label for="region-filter" class="form-label">Regi√£o</label>
                    <select id="region-filter" class="form-select" aria-describedby="region-help">
                        <option value="">Todas as regi√µes</option>
                        <!-- Op√ß√µes carregadas dinamicamente -->
                    </select>
                    <small id="region-help" class="text-muted">Filtre por regi√£o espec√≠fica</small>
                </div>

                <div class="filter-group">
                    <label for="status-filter" class="form-label">Status</label>
                    <select id="status-filter" class="form-select" aria-describedby="status-help">
                        <option value="">Todos os status</option>
                        <option value="aberto">üü¢ Aberto</option>
                        <option value="em_andamento">üü° Em Andamento</option>
                        <option value="aguardando">üü† Aguardando Retorno</option>
                        <option value="resolvido">‚úÖ Resolvido</option>
                        <option value="cancelado">‚ùå Cancelado</option>
                    </select>
                    <small id="status-help" class="text-muted">Filtre por status do chamado</small>
                </div>

                <div class="filter-group">
                    <label for="church-filter" class="form-label">Igreja</label>
                    <select id="church-filter" class="form-select" aria-describedby="church-help">
                        <option value="">Todas as igrejas</option>
                        <!-- Op√ß√µes carregadas dinamicamente -->
                    </select>
                    <small id="church-help" class="text-muted">Filtre por igreja espec√≠fica</small>
                </div>

                <div class="filter-group">
                    <label for="volunteer-filter" class="form-label">Volunt√°rio</label>
                    <select id="volunteer-filter" class="form-select" aria-describedby="volunteer-help">
                        <option value="">Todos os volunt√°rios</option>
                        <!-- Op√ß√µes carregadas dinamicamente -->
                    </select>
                    <small id="volunteer-help" class="text-muted">Filtre por volunt√°rio respons√°vel</small>
                </div>

                <div class="filter-group">
                    <label for="priority-filter" class="form-label">Prioridade</label>
                    <select id="priority-filter" class="form-select">
                        <option value="">Todas as prioridades</option>
                        <option value="Baixa">üü¢ Baixa</option>
                        <option value="M√©dia">üü° M√©dia</option>
                        <option value="Alta">üü† Alta</option>
                        <option value="Urgente">üî¥ Urgente</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="date-filter" class="form-label">Per√≠odo</label>
                    <select id="date-filter" class="form-select" aria-describedby="date-help">
                        <option value="">Todos os per√≠odos</option>
                        <option value="today">Hoje</option>
                        <option value="week">Esta semana</option>
                        <option value="month">Este m√™s</option>
                        <option value="quarter">√öltimos 3 meses</option>
                        <option value="year">Este ano</option>
                        <option value="custom">Per√≠odo personalizado</option>
                    </select>
                    <small id="date-help" class="text-muted">Filtre por per√≠odo espec√≠fico</small>
                </div>

                <div class="filter-group">
                    <label for="ticket-search" class="form-label">Buscar</label>
                    <input 
                        type="search" 
                        id="ticket-search" 
                        class="form-input" 
                        placeholder="Nome, ID, descri√ß√£o..."
                        aria-describedby="search-help"
                    >
                    <small id="search-help" class="text-muted">Digite para buscar chamados</small>
                </div>

                <!-- Advanced filters toggle -->
                <div class="filter-group">
                    <button id="advanced-filters-btn" class="btn btn-outline btn-small" aria-label="Filtros avan√ßados">
                        <span class="icon">‚öôÔ∏è</span>
                        <span class="btn-text">Filtros Avan√ßados</span>
                    </button>
                </div>
            </div>

            <!-- Advanced Filters Panel -->
            <div id="advanced-filters-panel" class="advanced-filters" style="display: none;" role="region" aria-label="Filtros avan√ßados">
                <div class="filters">
                    <div class="filter-group">
                        <label for="category-filter" class="form-label">Categoria</label>
                        <select id="category-filter" class="form-select">
                            <option value="">Todas as categorias</option>
                            <!-- Op√ß√µes carregadas dinamicamente -->
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="date-from" class="form-label">Data Inicial</label>
                        <input type="date" id="date-from" class="form-input">
                    </div>

                    <div class="filter-group">
                        <label for="date-to" class="form-label">Data Final</label>
                        <input type="date" id="date-to" class="form-input">
                    </div>

                    <div class="filter-group">
                        <label for="age-group-filter" class="form-label">Faixa Et√°ria</label>
                        <select id="age-group-filter" class="form-select">
                            <option value="">Todas as idades</option>
                            <option value="0-17">0-17 anos</option>
                            <option value="18-29">18-29 anos</option>
                            <option value="30-49">30-49 anos</option>
                            <option value="50-64">50-64 anos</option>
                            <option value="65+">65+ anos</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Summary Cards -->
            <div class="summary-section mb-4" role="region" aria-label="Resumo estat√≠stico">
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-icon">üìä</div>
                        <div class="kpi-content">
                            <div class="kpi-value" id="total-tickets" aria-label="Total de chamados">-</div>
                            <div class="kpi-label">Total de Chamados</div>
                            <div class="kpi-trend" id="total-trend">-</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">üü¢</div>
                        <div class="kpi-content">
                            <div class="kpi-value" id="open-tickets" aria-label="Chamados abertos">-</div>
                            <div class="kpi-label">Abertos</div>
                            <div class="kpi-trend" id="open-trend">-</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">üü°</div>
                        <div class="kpi-content">
                            <div class="kpi-value" id="progress-tickets" aria-label="Em andamento">-</div>
                            <div class="kpi-label">Em Andamento</div>
                            <div class="kpi-trend" id="progress-trend">-</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">‚úÖ</div>
                        <div class="kpi-content">
                            <div class="kpi-value" id="resolved-tickets" aria-label="Resolvidos">-</div>
                            <div class="kpi-label">Resolvidos</div>
                            <div class="kpi-trend" id="resolved-trend">-</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">üî¥</div>
                        <div class="kpi-content">
                            <div class="kpi-value" id="urgent-tickets" aria-label="Urgentes">-</div>
                            <div class="kpi-label">Urgentes</div>
                            <div class="kpi-trend" id="urgent-trend">-</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">‚è±Ô∏è</div>
                        <div class="kpi-content">
                            <div class="kpi-value" id="avg-resolution-time" aria-label="Tempo m√©dio de resolu√ß√£o">-</div>
                            <div class="kpi-label">Tempo M√©dio</div>
                            <div class="kpi-trend" id="time-trend">-</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tickets Section -->
            <div class="tickets-section">
                <div class="section-header">
                    <h3>Lista de Chamados</h3>
                    <div class="section-actions">
                        <div class="tickets-count">
                            <span id="tickets-count" aria-live="polite">Carregando...</span>
                        </div>
                        <div class="view-controls">
                            <button id="card-view-btn" class="btn btn-small active" aria-label="Visualiza√ß√£o em cards" title="Cards">
                                üìã
                            </button>
                            <button id="table-view-btn" class="btn btn-small" aria-label="Visualiza√ß√£o em tabela" title="Tabela">
                                üìä
                            </button>
                            <button id="kanban-view-btn" class="btn btn-small" aria-label="Visualiza√ß√£o kanban" title="Kanban">
                                üìã
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Card View -->
                <div id="tickets-card-view" class="tickets-container" role="region" aria-live="polite" aria-label="Lista de chamados em cards">
                    <div class="loading-placeholder">
                        <div class="spinner"></div>
                        <p>Carregando chamados...</p>
                    </div>
                </div>

                <!-- Table View -->
                <div id="tickets-table-view" class="table-container" style="display: none;" role="region" aria-label="Lista de chamados em tabela">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>
                                        <button class="sort-btn" data-sort="id" aria-label="Ordenar por ID">
                                            ID <span class="sort-icon">‚ÜïÔ∏è</span>
                                        </button>
                                    </th>
                                    <th>
                                        <button class="sort-btn" data-sort="nome" aria-label="Ordenar por nome">
                                            Nome <span class="sort-icon">‚ÜïÔ∏è</span>
                                        </button>
                                    </th>
                                    <th>
                                        <button class="sort-btn" data-sort="categoria" aria-label="Ordenar por categoria">
                                            Categoria <span class="sort-icon">‚ÜïÔ∏è</span>
                                        </button>
                                    </th>
                                    <th>
                                        <button class="sort-btn" data-sort="prioridade" aria-label="Ordenar por prioridade">
                                            Prioridade <span class="sort-icon">‚ÜïÔ∏è</span>
                                        </button>
                                    </th>
                                    <th>
                                        <button class="sort-btn" data-sort="status" aria-label="Ordenar por status">
                                            Status <span class="sort-icon">‚ÜïÔ∏è</span>
                                        </button>
                                    </th>
                                    <th>
                                        <button class="sort-btn" data-sort="voluntario" aria-label="Ordenar por volunt√°rio">
                                            Volunt√°rio <span class="sort-icon">‚ÜïÔ∏è</span>
                                        </button>
                                    </th>
                                    <th>
                                        <button class="sort-btn" data-sort="dataAbertura" aria-label="Ordenar por data">
                                            Data <span class="sort-icon">‚ÜïÔ∏è</span>
                                        </button>
                                    </th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="tickets-table-body">
                                <!-- Table rows will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Kanban View -->
                <div id="tickets-kanban-view" class="kanban-container" style="display: none;" role="region" aria-label="Lista de chamados em kanban">
                    <div class="kanban-columns">
                        <div class="kanban-column" data-status="aberto">
                            <div class="kanban-header">
                                <h4>üü¢ Abertos</h4>
                                <span class="kanban-count" id="kanban-aberto-count">0</span>
                            </div>
                            <div class="kanban-items" id="kanban-aberto-items"></div>
                        </div>
                        <div class="kanban-column" data-status="em_andamento">
                            <div class="kanban-header">
                                <h4>üü° Em Andamento</h4>
                                <span class="kanban-count" id="kanban-em_andamento-count">0</span>
                            </div>
                            <div class="kanban-items" id="kanban-em_andamento-items"></div>
                        </div>
                        <div class="kanban-column" data-status="aguardando">
                            <div class="kanban-header">
                                <h4>üü† Aguardando</h4>
                                <span class="kanban-count" id="kanban-aguardando-count">0</span>
                            </div>
                            <div class="kanban-items" id="kanban-aguardando-items"></div>
                        </div>
                        <div class="kanban-column" data-status="resolvido">
                            <div class="kanban-header">
                                <h4>‚úÖ Resolvidos</h4>
                                <span class="kanban-count" id="kanban-resolvido-count">0</span>
                            </div>
                            <div class="kanban-items" id="kanban-resolvido-items"></div>
                        </div>
                    </div>
                </div>

                <!-- Pagination -->
                <div id="pagination" class="pagination" style="display: none;" role="navigation" aria-label="Navega√ß√£o de p√°ginas">
                    <!-- Pagination will be generated dynamically -->
                </div>
            </div>
        </div>
    </main>

    <!-- New Ticket Modal -->
    <div id="new-ticket-modal" class="modal" role="dialog" aria-labelledby="new-ticket-title" aria-hidden="true">
        <div class="modal-content">
            <header class="modal-header">
                <h3 id="new-ticket-title">‚ûï Novo Chamado</h3>
                <button class="modal-close" aria-label="Fechar modal">&times;</button>
            </header>
            
            <form id="new-ticket-form" role="form" aria-labelledby="new-ticket-title">
                <div class="grid grid-2">
                    <div class="form-group">
                        <label for="nome" class="form-label">Nome do Cidad√£o *</label>
                        <input 
                            type="text" 
                            id="nome" 
                            name="nome" 
                            class="form-input" 
                            required
                            placeholder="Nome completo do cidad√£o"
                            aria-describedby="nome-error"
                        >
                        <span id="nome-error" class="field-error" role="alert" aria-live="polite"></span>
                    </div>

                    <div class="form-group">
                        <label for="contato" class="form-label">Telefone/WhatsApp *</label>
                        <input 
                            type="tel" 
                            id="contato" 
                            name="contato" 
                            class="form-input" 
                            data-format="phone"
                            required
                            placeholder="(11) 99999-9999"
                            aria-describedby="contato-error"
                        >
                        <span id="contato-error" class="field-error" role="alert" aria-live="polite"></span>
                    </div>
                </div>

                <div class="grid grid-2">
                    <div class="form-group">
                        <label for="email" class="form-label">Email (opcional)</label>
                        <input 
                            type="email" 
                            id="email" 
                            name="email" 
                            class="form-input" 
                            placeholder="email@exemplo.com"
                            aria-describedby="email-error"
                        >
                        <span id="email-error" class="field-error" role="alert" aria-live="polite"></span>
                    </div>

                    <div class="form-group">
                        <label for="cpf" class="form-label">CPF (opcional)</label>
                        <input 
                            type="text" 
                            id="cpf" 
                            name="cpf" 
                            class="form-input" 
                            data-format="cpf"
                            placeholder="000.000.000-00"
                            aria-describedby="cpf-error"
                        >
                        <span id="cpf-error" class="field-error" role="alert" aria-live="polite"></span>
                    </div>
                </div>

                <div class="grid grid-2">
                    <div class="form-group">
                        <label for="igreja" class="form-label">Igreja *</label>
                        <select id="igreja" name="igreja" class="form-select" required aria-describedby="igreja-error">
                            <option value="">Selecione a igreja</option>
                            <!-- Op√ß√µes carregadas dinamicamente -->
                        </select>
                        <span id="igreja-error" class="field-error" role="alert" aria-live="polite"></span>
                    </div>

                    <div class="form-group">
                        <label for="regiao" class="form-label">Regi√£o *</label>
                        <select id="regiao" name="regiao" class="form-select" required aria-describedby="regiao-error">
                            <option value="">Selecione a regi√£o</option>
                            <!-- Op√ß√µes carregadas dinamicamente -->
                        </select>
                        <span id="regiao-error" class="field-error" role="alert" aria-live="polite"></span>
                    </div>
                </div>

                <div class="grid grid-2">
                    <div class="form-group">
                        <label for="categoria" class="form-label">Categoria da Demanda *</label>
                        <select id="categoria" name="categoria" class="form-select" required aria-describedby="categoria-error">
                            <option value="">Selecione a categoria</option>
                            <!-- Op√ß√µes carregadas dinamicamente -->
                        </select>
                        <span id="categoria-error" class="field-error" role="alert" aria-live="polite"></span>
                    </div>

                    <div class="form-group">
                        <label for="prioridade" class="form-label">Prioridade *</label>
                        <select id="prioridade" name="prioridade" class="form-select" required aria-describedby="prioridade-error">
                            <option value="">Selecione a prioridade</option>
                            <option value="Baixa">üü¢ Baixa - Pode aguardar alguns dias</option>
                            <option value="M√©dia">üü° M√©dia - Necessita aten√ß√£o em breve</option>
                            <option value="Alta">üü† Alta - Precisa ser resolvido rapidamente</option>
                            <option value="Urgente">üî¥ Urgente - Requer a√ß√£o imediata</option>
                        </select>
                        <span id="prioridade-error" class="field-error" role="alert" aria-live="polite"></span>
                    </div>
                </div>

                <div class="form-group" id="demanda-container" style="display: none;">
                    <label for="demanda" class="form-label">Demanda Espec√≠fica *</label>
                    <select id="demanda" name="demanda" class="form-select" aria-describedby="demanda-error">
                        <option value="">Primeiro selecione uma categoria</option>
                        <!-- Op√ß√µes carregadas dinamicamente baseadas na categoria -->
                    </select>
                    <span id="demanda-error" class="field-error" role="alert" aria-live="polite"></span>
                </div>

                <div class="form-group">
                    <label for="descricao" class="form-label">Descri√ß√£o da Demanda *</label>
                    <textarea 
                        id="descricao" 
                        name="descricao" 
                        class="form-textarea" 
                        required
                        placeholder="Descreva detalhadamente a necessidade do cidad√£o..."
                        rows="4"
                        aria-describedby="descricao-error"
                    ></textarea>
                    <span id="descricao-error" class="field-error" role="alert" aria-live="polite"></span>
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary">
                        <span class="btn-text">üíæ Salvar Chamado</span>
                        <span class="loading-spinner hidden" aria-hidden="true"></span>
                    </button>
                    <button type="button" class="btn btn-outline modal-close">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Ticket Modal -->
    <div id="edit-ticket-modal" class="modal" role="dialog" aria-labelledby="edit-ticket-title" aria-hidden="true">
        <div class="modal-content">
            <header class="modal-header">
                <h3 id="edit-ticket-title">‚úèÔ∏è Editar Chamado</h3>
                <button class="modal-close" aria-label="Fechar modal">&times;</button>
            </header>
            
            <form id="edit-ticket-form" role="form" aria-labelledby="edit-ticket-title">
                <!-- Form fields will be populated dynamically -->
            </form>
        </div>
    </div>

    <!-- View Ticket Modal -->
    <div id="view-ticket-modal" class="modal" role="dialog" aria-labelledby="view-ticket-title" aria-hidden="true">
        <div class="modal-content">
            <header class="modal-header">
                <h3 id="view-ticket-title">üîç Detalhes do Chamado</h3>
                <button class="modal-close" aria-label="Fechar modal">&times;</button>
            </header>
            
            <div id="ticket-details" role="region" aria-live="polite">
                <!-- Ticket details will be loaded here -->
                <div class="loading-placeholder">
                    <div class="spinner"></div>
                    <p>Carregando detalhes...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Assign Professional Modal -->
    <div id="assign-professional-modal" class="modal" role="dialog" aria-labelledby="assign-professional-title" aria-hidden="true">
        <div class="modal-content">
            <header class="modal-header">
                <h3 id="assign-professional-title">üë®‚Äç‚öïÔ∏è Atribuir Profissional</h3>
                <button class="modal-close" aria-label="Fechar modal">&times;</button>
            </header>
            
            <form id="assign-professional-form" role="form">
                <div class="form-group">
                    <label for="professional-select" class="form-label">Selecione o Profissional *</label>
                    <select id="professional-select" name="professional" class="form-select" required>
                        <option value="">Selecione um profissional</option>
                        <!-- Op√ß√µes carregadas dinamicamente -->
                    </select>
                </div>

                <div class="form-group">
                    <label for="assignment-notes" class="form-label">Observa√ß√µes</label>
                    <textarea 
                        id="assignment-notes" 
                        name="notes" 
                        class="form-textarea" 
                        placeholder="Adicione observa√ß√µes sobre esta atribui√ß√£o..."
                        rows="3"
                    ></textarea>
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary">
                        <span class="btn-text">üíæ Atribuir Profissional</span>
                        <span class="loading-spinner hidden" aria-hidden="true"></span>
                    </button>
                    <button type="button" class="btn btn-outline modal-close">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script src="data/config.js"></script>
    <script src="scripts/helpers.js"></script>
    <script src="scripts/auth.js"></script>
    <script src="scripts/flow.js"></script>
    <script src="scripts/secretaria.js"></script>

    <!-- Secretaria specific styles -->
    <style>
        /* Screen reader only content */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        .sr-only:focus {
            position: static;
            width: auto;
            height: auto;
            padding: var(--spacing-sm);
            margin: 0;
            overflow: visible;
            clip: auto;
            white-space: normal;
            background-color: var(--primary-color);
            color: white;
            text-decoration: none;
            border-radius: var(--radius);
            z-index: var(--z-tooltip);
        }

        /* Page header */
        .page-header h1 {
            color: var(--primary-color);
            margin-bottom: var(--spacing-sm);
            font-size: var(--font-3xl);
        }

        /* Actions section */
        .actions-section {
            display: flex;
            gap: var(--spacing-md);
            flex-wrap: wrap;
            align-items: center;
        }

        .actions-section .btn {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .icon {
            font-size: var(--font-base);
        }

        /* Advanced filters */
        .advanced-filters {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            border: 1px solid var(--border-color);
        }

        /* Summary section improvements */
        .summary-section {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            border: 1px solid var(--border-color);
        }

        /* View controls */
        .view-controls {
            display: flex;
            gap: var(--spacing-xs);
        }

        .view-controls .btn {
            min-width: 40px;
            padding: var(--spacing-xs);
        }

        .view-controls .btn.active {
            background: var(--primary-color);
            color: white;
        }

        /* Kanban view */
        .kanban-container {
            background: var(--bg-light);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            overflow-x: auto;
        }

        .kanban-columns {
            display: flex;
            gap: var(--spacing-lg);
            min-width: 800px;
        }

        .kanban-column {
            flex: 1;
            min-width: 250px;
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: var(--spacing-md);
            border: 1px solid var(--border-color);
        }

        .kanban-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-sm);
            border-bottom: 2px solid var(--border-color);
        }

        .kanban-header h4 {
            margin: 0;
            font-size: var(--font-lg);
            color: var(--text-primary);
        }

        .kanban-count {
            background: var(--primary-color);
            color: white;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-full);
            font-size: var(--font-sm);
            font-weight: var(--font-semibold);
        }

        .kanban-items {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
            min-height: 200px;
        }

        .kanban-item {
            background: white;
            border: 1px solid var(--border-light);
            border-radius: var(--radius);
            padding: var(--spacing-md);
            cursor: pointer;
            transition: var(--transition);
        }

        .kanban-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .kanban-item-title {
            font-weight: var(--font-semibold);
            color: var(--text-primary);
            margin-bottom: var(--spacing-xs);
        }

        .kanban-item-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: var(--font-sm);
            color: var(--text-secondary);
        }

        /* Sort buttons */
        .sort-btn {
            background: none;
            border: none;
            color: var(--text-primary);
            font-weight: var(--font-semibold);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-xs);
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }

        .sort-btn:hover {
            background: rgba(0, 198, 255, 0.1);
        }

        .sort-icon {
            font-size: var(--font-sm);
        }

        /* Loading placeholder */
        .loading-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-2xl);
            color: var(--text-secondary);
        }

        /* Notification badge */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger-color);
            color: white;
            font-size: var(--font-xs);
            padding: 2px 6px;
            border-radius: var(--radius-full);
            min-width: 20px;
            text-align: center;
        }

        .btn {
            position: relative;
        }

        /* Form improvements */
        .form-label {
            font-weight: var(--font-medium);
            margin-bottom: var(--spacing-xs);
        }

        .text-muted {
            color: var(--text-muted);
            font-size: var(--font-xs);
        }

        /* Table improvements */
        .table-responsive {
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--border-light);
            text-align: left;
        }

        .table th {
            background: var(--bg-light);
            font-weight: var(--font-semibold);
            color: var(--text-primary);
        }

        .table tbody tr:hover {
            background: rgba(0, 198, 255, 0.05);
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .actions-section {
                flex-direction: column;
                align-items: stretch;
            }

            .actions-section .btn {
                width: 100%;
                justify-content: center;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-sm);
            }

            .section-actions {
                width: 100%;
                justify-content: space-between;
            }

            .view-controls {
                width: 100%;
                justify-content: center;
            }

            .kanban-columns {
                min-width: 600px;
            }

            .kanban-column {
                min-width: 200px;
            }

            .kpi-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .kpi-grid {
                grid-template-columns: 1fr;
            }

            .user-actions {
                flex-direction: column;
                gap: var(--spacing-xs);
            }

            .user-actions .btn {
                width: 100%;
                font-size: var(--font-sm);
            }

            .kanban-columns {
                flex-direction: column;
                min-width: auto;
            }

            .kanban-column {
                min-width: auto;
            }
        }
    </style>

    <!-- Scripts Dependencies -->
    <script src="data/config.js"></script>
    <script src="scripts/helpers.js"></script>
    <script src="scripts/flow.js"></script>
    <script src="scripts/auth.js"></script>
    <script src="scripts/secretaria.js"></script>

    <!-- Initialize Secretaria -->
    <script>
        // Initialize secretaria when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üìã Inicializando secretaria...');
            
            // Verificar depend√™ncias
            if (typeof window.CONFIG === 'undefined') {
                console.error('‚ùå CONFIG n√£o carregado');
                return;
            }
            
            if (typeof window.AuthManager === 'undefined') {
                console.error('‚ùå AuthManager n√£o carregado');
                return;
            }

            // Initialize components
            window.authManager = new AuthManager();
            window.flowManager = new FlowExtensions();
            
            // Verificar autentica√ß√£o
            if (!window.authManager.isAuthenticated()) {
                console.log('‚ùå Usu√°rio n√£o autenticado, redirecionando...');
                window.location.href = 'index.html';
                return;
            }

            // Verificar permiss√µes (secretaria ou coordenador)
            const user = window.authManager.getCurrentUser();
            if (!user || !['secretaria', 'coordenador', 'coordenador_local'].includes(user.cargo)) {
                console.log('‚ùå Usu√°rio sem permiss√£o para secretaria');
                window.Helpers.showToast('Voc√™ n√£o tem permiss√£o para acessar esta √°rea', 'error');
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 2000);
                return;
            }

            // Initialize secretaria manager
            if (typeof SecretariaManager !== 'undefined') {
                window.secretariaManager = new SecretariaManager();
            }
            
            console.log('‚úÖ Secretaria inicializada com sucesso');
        });
    </script>
</body>
</html>
