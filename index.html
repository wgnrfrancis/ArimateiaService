<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <!-- Meta Tags Essenciais -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- SEO e Descri√ß√£o -->
    <title>Balc√£o da Cidadania - Sistema de Atendimento | Arimateia</title>
    <meta name="description" content="Sistema de gest√£o de atendimento ao cidad√£o da Arimateia. Acesse para gerenciar chamados e servi√ßos p√∫blicos.">
    <meta name="keywords" content="balc√£o cidadania, atendimento p√∫blico, arimateia, gest√£o chamados">
    <meta name="author" content="Arimateia">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Balc√£o da Cidadania - Arimateia">
    <meta property="og:description" content="Sistema de gest√£o de atendimento ao cidad√£o">
    <meta property="og:url" content="https://balcao.arimateia.org">
    
    <!-- Favicon e Icons -->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png">
    
    <!-- Preload Critical Resources -->
    <link rel="preload" href="assets/style.css" as="style">
    <link rel="preload" href="data/config.js" as="script">
    
    <!-- Stylesheet -->
    <link rel="stylesheet" href="assets/style.css">
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' 'unsafe-eval' https://script.google.com https://script.googleusercontent.com https://apis.google.com;
        style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com;
        font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com;
        img-src 'self' data: https:;
        connect-src 'self' https: https://script.google.com https://script.googleusercontent.com https://docs.google.com https://sheets.googleapis.com;
        frame-src 'none';
        object-src 'none';
        base-uri 'self';
        form-action 'self' https://script.google.com;
    ">
</head>
<body>
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="sr-only">Pular para o conte√∫do principal</a>
    
    <main id="main-content" class="login-container" role="main">
        <div class="login-card">
            <header class="login-header">
                <div class="logo-square" aria-label="Logo Arimateia">A</div>
                <h1>ARIMATEIA<br><small>SERVICE</small></h1>
                <p class="text-light">Sistema de Gest√£o de Atendimento ao Cidad√£o</p>
            </header>

            <form id="login-form" class="login-form" role="form" aria-label="Formul√°rio de login">
                <div id="login-status" class="hidden" role="alert" aria-live="polite"></div>
                
                <div class="form-group">
                    <label for="email" class="form-label">Email</label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        class="form-input" 
                        placeholder="seu.email@arimateia.org"
                        required
                        autocomplete="email"
                        aria-describedby="email-error"
                    >
                    <span id="email-error" class="field-error" role="alert" aria-live="polite"></span>
                </div>

                <div class="form-group">
                    <label for="password" class="form-label">Senha</label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        class="form-input" 
                        placeholder="Digite sua senha"
                        required
                        autocomplete="current-password"
                        aria-describedby="password-error"
                    >
                    <span id="password-error" class="field-error" role="alert" aria-live="polite"></span>
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary btn-large w-full" id="login-btn">
                        <span class="btn-text">Entrar</span>
                        <span class="loading-spinner hidden" aria-hidden="true"></span>
                    </button>
                </div>

                <div class="form-group text-center">
                    <a href="#" class="text-secondary" id="forgot-password">Esqueceu sua senha?</a>
                </div>
            </form>

            <footer class="login-footer">
                <div class="text-center">
                    <p class="text-light">
                        N√£o tem uma conta? 
                        <a href="cadastro.html" class="text-primary">Cadastre-se como volunt√°rio</a>
                    </p>
                </div>

                <div class="login-info mt-4">
                    <p class="text-center text-light">
                        <small>¬© 2024 Arimateia - Balc√£o da Cidadania v2.0</small>
                    </p>
                </div>
            </footer>
        </div>
    </main>

    <!-- Accessibility and SEO improvements -->
    <style>
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        .sr-only:focus {
            position: static;
            width: auto;
            height: auto;
            padding: var(--spacing-sm);
            margin: 0;
            overflow: visible;
            clip: auto;
            white-space: normal;
            background-color: var(--primary-color);
            color: white;
            text-decoration: none;
            border-radius: var(--radius);
            z-index: var(--z-tooltip);
        }

        .alert {
            padding: var(--spacing-md);
            border-radius: var(--radius);
            margin-bottom: var(--spacing-md);
            font-size: var(--font-sm);
            font-weight: var(--font-medium);
        }

        .alert-error {
            background-color: rgba(244, 67, 54, 0.1);
            border: 1px solid var(--danger-color);
            color: var(--danger-color);
        }

        .alert-success {
            background-color: rgba(76, 175, 80, 0.1);
            border: 1px solid var(--success-color);
            color: var(--success-color);
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: var(--radius-full);
            animation: spin 1s linear infinite;
        }

        .btn.loading {
            pointer-events: none;
            opacity: 0.8;
        }

        .btn.loading .loading-spinner {
            margin-left: var(--spacing-sm);
        }

        .field-error {
            display: block;
            margin-top: var(--spacing-xs);
            font-size: var(--font-xs);
            color: var(--danger-color);
            font-weight: var(--font-medium);
        }

        .form-input.error {
            border-color: var(--danger-color);
            box-shadow: 0 0 0 3px rgba(244, 67, 54, 0.1);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Login specific styles */
        .login-footer {
            margin-top: var(--spacing-xl);
            padding-top: var(--spacing-lg);
            border-top: 1px solid var(--border-light);
        }

        .login-info {
            opacity: 0.8;
        }

        /* Focus management */
        .login-card *:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* Mobile improvements */
        @media (max-width: 600px) {
            .login-card {
                margin: var(--spacing-md);
                padding: var(--spacing-lg);
            }
            
            .logo-square {
                width: 48px;
                height: 48px;
                font-size: 2rem;
            }
        }
    </style>

    <!-- Scripts Dependencies -->
    <script src="data/config.js"></script>
    <script src="scripts/helpers.js"></script>
    <script src="scripts/flow.js"></script>
    <script src="scripts/auth.js"></script>
    <script src="scripts/login.js"></script>

    <!-- Initialize Login -->
    <script>
        // Initialize login system
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Inicializando Balc√£o da Cidadania...');
            
            // Verificar se depend√™ncias carregaram
            if (typeof window.CONFIG === 'undefined' || 
                typeof window.Helpers === 'undefined' || 
                typeof AuthManager === 'undefined') {
                console.error('‚ùå Depend√™ncias n√£o carregaram corretamente');
                document.body.innerHTML = '<div style="text-align:center;padding:50px;"><h2>Erro ao carregar sistema</h2><p>Verifique se todos os arquivos est√£o presentes.</p></div>';
                return;
            }

            try {
                // Initialize managers
                window.authManager = new AuthManager();
                window.flowManager = new FlowExtensions();
                window.loginManager = new LoginManager();
                
                console.log('‚úÖ Sistema inicializado com sucesso');
                
                // Verificar se j√° est√° logado
                if (window.authManager.isAuthenticated()) {
                    const user = window.authManager.getCurrentUser();
                    console.log('üë§ Usu√°rio j√° logado, redirecionando...');
                    
                    // Redirecionar baseado no cargo
                    if (user.cargo === 'secretaria' || user.cargo === 'coordenador') {
                        window.location.href = 'secretaria.html';
                    } else {
                        window.location.href = 'dashboard.html';
                    }
                }
                
            } catch (error) {
                console.error('‚ùå Erro na inicializa√ß√£o:', error);
            }
        });
    </script>
</body>
</html>
